---
title: "ベイジアンネットワークを用いたWebレコメンデーションシステムの開発"
date: 2020-10-22T16:09:01+09:00
# draft: true
tags: ["Papers", "ベイズ", "レコメンデーション"]
---

### ベイジアンネットワークを用いたWebレコメンデーションシステムの開発
##### https://www.jstage.jst.go.jp/article/pjsai/JSAI07/0/JSAI07_3H73/_article/-char/ja/
##### 山崎 敬広, ソンムァン ポクポン, 石山 洸, 高田 健一郎, 植野 真臣
##### 第21回全国大会(2007)

---

### 何をしたの？
いわゆる実装してみた系。ベイジアンネットワークのアルゴリズムである、MWSTアルゴリズムと高速化のための工夫としてPearl’s Message Passingアルゴリズムを実装して、サイト内各ページの閲覧回数を変数として、各ページの閲覧確率の関係をデータから学習し、大規模なベイジアンネットワークを構築して評価した。

### コントリビューション
MWSTアルゴリズムの計算量が高々$ O(n^2) $な上、さらに高速にネットワーク上の全ノードの周辺事後確率を求める手法としてPearl’s Message Passingアルゴリズムを用いたので高速な動作が見込める。

### ベイジアンネットワークについて
アイシアちゃんの動画
[【因果を利用した分析】ベイジアンネットワークで見る変数の因果関係【いろんな分析 vol. 5 】 #060 ](https://www.youtube.com/watch?v=knCbMFQJXxY)

因果をノード、依存関係を有効アークとして確率ネットワークを構築した、確率構造を表すDAG(Directed AcyclicGraph)と条件付確率パラメータ集合で表現される。

#### MWSTアルゴリズム
各変数間の相互情報量を基準として木を構築する手法  
実行ステップを論文より引用
> 1. 与えられたデータより，$N(N−1)/2$個の枝について，すべての枝の相互情報量$I(x_i;x_j)$を求める．
> 2. もっとも大きな相互情報量を示す枝を取り出し，木を構成する枝とする．
> 3. 次に大きな相互情報量を示す枝を木に加えるが，ループが出来るならその枝を捨てる．
> 4. ステップ3を$N-1$個の枝が木に加わるまで繰り返す．
> 5. 最後に根ノードを決定し，根から葉へ向かうように枝に方向を付ける．

要するに相互情報量が最大化するようにループのない木を作成した後に、それを有向グラフに変換する。

##### メリット
- 二次統計量までしか用いないため，データからの演算が容易で信頼できる
- 計算量がノード数nに対して高々O(n2)

---

#### Pearl’s Message Passingアルゴリズム
ベイジアンネットワークでは、ネットワークを構築した後や、ノードにデータを与えた時、あるノードの事後確率を求めるのに，周辺化を行う必要がある。この周辺化について、ネットワーク構造を利用して効率的に計算するアルゴリズム。

実行ステップを論文より引用
> 1. 証拠データを与えられたノードから，その周辺ノードへ向けてメッセージの送信を行う．
> 2. メッセージを受信したノードは，受信したメッセージを用いて，自分の周辺事後確率を更新する．
> 3. 周辺事後確率を更新したノードは，メッセージの送信元以外の自分の周辺ノードにメッセージを送信する．
> 4. 2,3を繰り返し，全てのノードの周辺事後確率を更新する．

あんまり具体的にどうするのか書いてない気がするが、新しくデータが加えられたノードから伝搬する形で事後確率を更新していくんだと思う。

##### メリット
高速かつ厳密に，全ノードの周辺事後確率を求めることが出来る

##### デメリット
ループがあると使えない、MWSTアルゴリズムではループが生まれない(というかループを持たないものがベイジアンネットワークなのでは？)

---

### Web推薦システム概要
ページ数10万規模のWebサイトについて取り扱う。様々なジャンルのWebページの中からユーザが好みそうなページを推薦する。推薦方法としては、トップページの様々なページへのリンクを並び替え、推薦するページへのリンクを上部に置くような方法を取る。
ページの閲覧履歴からベイジアンネットワークを構築。各ユーザごとに各ページの閲覧確率の推論を行い、得られた結果に応じて推薦するWebページを選択。  

#### 具体的な実装
1. 全ユーザにおける各ページの閲覧確率を求め、これを用いてMWSTアルゴリズムでベイジアンネットワークを構築。根ノードに最も見られているページを設定。
2. あるユーザが閲覧したページをデータとしてベイジアンネットワークに与えて推論をPearl’s Message Passingアルゴリズムで行い、そのユーザにおける各ページの閲覧確率を求める。
3. 得られた閲覧確率から閲覧回数の期待値を求め、期待値が大きいページから順に並べる。

#### リミテーション
- 現状のシステムでは，Webサイト内の一部のWebページ(5000程度)しか行えない。
    + 現状では、サイト内の各ページを数十個のカテゴリに分け、各カテゴリを変数としてベイジアンネットワークを構築し、ユーザに対してカテゴリを推薦することを行っている。

### 実験手法
引用
> 1. ユーザが閲覧したページの中から推論に用いるページを選び，推論用データとする．
> 2. 推論用データから各ページの閲覧確率推論を行い，ページ閲覧回数の期待値を求める．
> 3. 期待値上位30位以内に，推論に用いたページ以外のユーザが閲覧したページがいくつ含まれるか数えあげる．
> 4. 3で数えあげた値を，推論に用いたページ以外のユーザが閲覧したページの数で割り，予測率を求める．
> 5. 推論に用いるページを1つずつ増やして1から4の処理を繰り返し，推論用データの数ごとに予測率を求める．これを推論用データの数が9個になるまで行う．

予測率の計算式  
例: 例えば、推論用のデータの数を2個として推論を行い、結果、期待値上位30位以内には残りの証拠データのうち6個が含まれていたとすると、予測率は
$$
\frac{(上位30位に含まれる推論用データ以外の証拠データの数)}{(全証拠データ数 − 推論用データ数)} = \frac{6}{8} = 0.75
$$

結果の表は論文を見て。

---

## 感想
- 予測率の計算式の証拠データが何を意味しているのかわからない。証拠って何？
- 結果で、推論データを与えないときと比べて、データによる推論を行うと予測率の平均値が上がるとしているが、全証拠数が一定となのだとすると、分母が小さくなっていくのでそれはそうとしか言えないんじゃないか？
- また、推論データをすでに閲覧したデータの中から持ってくるのは筋が悪いんじゃないかと思う。
- 30ページ推薦は個人的には数が多い気がする。
- 推薦結果の評価指標が微妙な気がする。なんかもっといいのがありそう。